# WhatsApp API 用户界面文档

本文档提供了关于 WhatsApp API 多实例服务的网页用户界面的全面信息。该用户界面允许用户通过直观的网页界面管理多个 WhatsApp 实例，提供消息发送、联系人管理和系统监控功能。

## 目录

1. [简介](#简介)
2. [身份验证](#身份验证)
3. [仪表盘](#仪表盘)
4. [实例管理](#实例管理)
   - [创建实例](#创建实例)
   - [编辑实例](#编辑实例)
   - [实例详情](#实例详情)
   - [连接实例](#连接实例)
5. [消息功能](#消息功能)
   - [迷你聊天界面](#迷你聊天界面)
   - [发送消息](#发送消息)
   - [发送媒体](#发送媒体)
6. [联系人管理](#联系人管理)
   - [查看联系人](#查看联系人)
   - [添加联系人](#添加联系人)
   - [导入联系人](#导入联系人)
7. [统计数据](#统计数据)
8. [用户资料](#用户资料)
9. [技术参考](#技术参考)
   - [API 端点](#api-端点)
   - [网络钩子](#网络钩子)

## 简介

WhatsApp API 管理器是一个基于网页的用户界面，允许您从单一界面管理多个 WhatsApp 实例。该系统支持创建和管理多个 WhatsApp 连接，发送和接收消息，管理联系人，以及监控使用统计。

主要功能：
- 多实例管理
- 实时消息
- 联系人管理
- 媒体共享
- 网络钩子集成用于通知
- 使用统计

## 身份验证

系统支持两种身份验证方法：

1. **电子邮件和密码**：使用注册的电子邮件和密码进行传统登录
2. **API 密钥**：使用个人 API 密钥进行身份验证

### 登录过程

1. 导航至 `/login` 页面
2. 输入您的凭据（电子邮件/密码或 API 密钥）
3. 身份验证成功后，您将被重定向到实例页面

## 仪表盘

主仪表盘提供了您的 WhatsApp 实例的概览。登录后，您可以通过导航到 `/ui/instances` 访问它。

仪表盘显示：
- 所有实例的列表
- 每个实例的当前连接状态
- 快速操作（查看详情、编辑、聊天、联系人、删除）
- 创建新实例的选项

## 实例管理

### 创建实例

要创建新的 WhatsApp 实例：

1. 点击仪表盘上的"创建新实例"按钮
2. 填写必要的详细信息：
   - **名称**：您实例的唯一标识符
   - **描述**：可选描述
   - **网络钩子设置**：配置通知首选项
     - 用于网络钩子的 URL
     - 通知类型（接收/发送消息、递送状态、已读状态）
     - 重试设置和安全网络钩子通信的密钥
3. 点击"创建实例"保存

### 编辑实例

要编辑现有实例：

1. 点击仪表盘上实例旁边的"编辑"按钮
2. 修改任何实例设置
3. 点击"保存更改"更新

### 实例详情

实例详情页面提供了关于特定实例的全面信息：

- 连接状态
- 实例信息（名称、描述、网络钩子 URL）
- 用于 WhatsApp 连接的二维码（适用时）
- 操作按钮（重新连接、登出）
- 聊天和联系人界面链接
- 最近活动日志

### 连接实例

要将实例连接到 WhatsApp：

1. 导航到实例详情页面
2. 如果未连接，您将看到二维码
3. 用移动 WhatsApp 应用程序扫描二维码：
   - 在手机上打开 WhatsApp
   - 进入设置 > WhatsApp 网页/桌面版
   - 扫描屏幕上显示的二维码
4. 连接后，状态将更改为"已连接"

如果二维码不可见或已过期：
1. 点击"重新连接"按钮
2. 等待新的二维码出现
3. 用移动 WhatsApp 扫描新码

## 消息功能

### 迷你聊天界面

聊天界面允许您实时发送和接收消息：

1. 通过点击实例上的"聊天"导航到聊天页面
2. 从左侧面板选择联系人开始对话
3. 聊天窗口显示与所选联系人的消息历史
4. 通过定期轮询自动显示新消息

### 发送消息

发送文本消息：

1. 从联系人面板选择联系人
2. 在底部的输入框中输入您的消息
3. 按 Enter 键或点击"发送"

### 发送媒体

发送媒体文件：

1. 从联系人面板选择联系人
2. 点击"附加文件"按钮
3. 从您的设备中选择一个文件
4. 添加可选的标题
5. 点击"发送媒体文件"

支持的媒体类型：
- 图片
- 视频
- 文档
- 音频文件

## 联系人管理

### 查看联系人

联系人页面显示与实例关联的所有联系人：

1. 通过点击实例上的"联系人"导航到联系人页面
2. 查看包含所有联系人详细信息的表格
3. 使用搜索框搜索特定联系人

您可以在两种联系人来源之间切换：
- **WhatsApp**：来自 WhatsApp 服务器的联系人
- **数据库**：存储在本地数据库中的联系人

### 添加联系人

添加新联系人：

1. 导航到联系人页面
2. 滚动到"添加新联系人"部分
3. 输入电话号码（必填）
4. 输入名称（可选）
5. 点击"添加联系人"

### 导入联系人

将联系人从 WhatsApp 导入到本地数据库：

1. 导航到联系人页面
2. 点击"导入联系人"按钮
3. 等待导入过程完成
4. 将显示成功消息，包含导入的联系人数量

## 统计数据

统计数据页面提供您的 WhatsApp 实例的使用指标：

1. 通过点击导航栏中的"统计数据"导航到统计数据页面
2. 选择时间段（周、月、年或全部时间）
3. 查看汇总统计：
   - 总共发送/接收的消息
   - 发送/接收的媒体文件
   - API 调用
   - 网络钩子调用
4. 在下方表格中查看各个实例的统计数据

## 用户资料

用户资料页面显示您的账户信息：

1. 导航到资料页面
2. 查看您的电子邮件地址
3. 查看并复制您的 API 密钥以进行编程访问
4. 查看您的姓名和其他账户详细信息

## 技术参考

### API 端点

用户界面与以下关键 API 端点交互：

- `/api/auth/login`：身份验证
- `/api/auth/me`：当前用户信息
- `/api/instances`：实例管理
- `/api/instances/:id`：单个实例操作
- `/api/instances/:id/qr`：二维码生成
- `/api/instances/:id/send`：发送消息
- `/api/instances/:id/contacts`：联系人管理
- `/api/stats/user`：使用统计

### 网络钩子

网络钩子允许外部系统接收事件通知：

**可配置事件：**
- 消息接收
- 消息发送
- 递送状态变更
- 已读状态变更

**网络钩子载荷格式：**
```json
{
  "event": "message_received",
  "data": {
    "instanceId": "实例-id",
    "messageId": "消息-id",
    "from": "发送者-id",
    "body": "消息-内容",
    "timestamp": "iso-日期-时间"
  },
  "timestamp": "iso-日期-时间"
}
```

**安全功能：**
- 用于载荷签名验证的密钥
- 失败递送的可配置重试机制
- 自定义 HTTP 头部支持