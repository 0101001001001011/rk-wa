# Документация по пользовательскому интерфейсу WhatsApp API

Этот документ предоставляет подробную информацию о веб-интерфейсе сервиса WhatsApp API с поддержкой нескольких инстансов. Пользовательский интерфейс позволяет управлять несколькими инстансами WhatsApp через интуитивно понятный веб-интерфейс, предоставляя возможности для обмена сообщениями, управления контактами и мониторинга системы.

## Содержание

1. [Введение](#введение)
2. [Аутентификация](#аутентификация)
3. [Панель управления](#панель-управления)
4. [Управление инстансами](#управление-инстансами)
   - [Создание инстансов](#создание-инстансов)
   - [Редактирование инстансов](#редактирование-инстансов)
   - [Детали инстанса](#детали-инстанса)
   - [Подключение инстансов](#подключение-инстансов)
5. [Обмен сообщениями](#обмен-сообщениями)
   - [Интерфейс мини-чата](#интерфейс-мини-чата)
   - [Отправка сообщений](#отправка-сообщений)
   - [Отправка медиафайлов](#отправка-медиафайлов)
6. [Управление контактами](#управление-контактами)
   - [Просмотр контактов](#просмотр-контактов)
   - [Добавление контактов](#добавление-контактов)
   - [Импорт контактов](#импорт-контактов)
7. [Статистика](#статистика)
8. [Профиль пользователя](#профиль-пользователя)
9. [Техническая информация](#техническая-информация)
   - [API эндпоинты](#api-эндпоинты)
   - [Вебхуки](#вебхуки)

## Введение

WhatsApp API Manager — это веб-интерфейс, который позволяет управлять несколькими инстансами WhatsApp с единой панели управления. Система поддерживает создание и управление несколькими подключениями WhatsApp, отправку и получение сообщений, управление контактами и мониторинг статистики использования.

Ключевые функции:
- Управление несколькими инстансами
- Обмен сообщениями в реальном времени
- Управление контактами
- Обмен медиафайлами
- Интеграция веб-хуков для уведомлений
- Статистика использования

## Аутентификация

Система поддерживает два метода аутентификации:

1. **Email и пароль**: Традиционный вход с использованием зарегистрированных email и пароля
2. **API ключ**: Аутентификация с использованием персонального API ключа

### Процесс входа

1. Перейдите на страницу `/login`
2. Введите ваши учетные данные (email/пароль или API ключ)
3. После успешной аутентификации вы будете перенаправлены на страницу инстансов

## Панель управления

Основная панель управления предоставляет обзор ваших инстансов WhatsApp. Вы можете получить к ней доступ, перейдя по адресу `/ui/instances` после входа в систему.

Панель управления отображает:
- Список всех ваших инстансов
- Текущий статус подключения каждого инстанса
- Быстрые действия (просмотр деталей, редактирование, чат, контакты, удаление)
- Возможность создания новых инстансов

## Управление инстансами

### Создание инстансов

Чтобы создать новый инстанс WhatsApp:

1. Нажмите кнопку "Создать новый инстанс" на панели управления
2. Заполните необходимые данные:
   - **Имя**: Уникальный идентификатор для вашего инстанса
   - **Описание**: Опциональное описание
   - **Настройки WebHook**: Настройте параметры уведомлений
     - URL для вебхуков
     - Типы уведомлений (полученные/отправленные сообщения, статус доставки, статус прочтения)
     - Настройки повторных попыток и секретный ключ для безопасной коммуникации вебхуков
3. Нажмите "Создать инстанс" для сохранения

### Редактирование инстансов

Чтобы отредактировать существующий инстанс:

1. Нажмите кнопку "Изменить" рядом с инстансом на панели управления
2. Измените любые настройки инстанса
3. Нажмите "Сохранить изменения" для обновления

### Детали инстанса

Страница деталей инстанса предоставляет подробную информацию о конкретном инстансе:

- Статус подключения
- Информация об инстансе (имя, описание, URL вебхука)
- QR-код для подключения WhatsApp (когда применимо)
- Кнопки действий (переподключение, выход)
- Ссылки на интерфейсы чата и контактов
- Журнал последних действий

### Подключение инстансов

Чтобы подключить инстанс к WhatsApp:

1. Перейдите на страницу деталей инстанса
2. Если инстанс не подключен, вы увидите QR-код
3. Отсканируйте QR-код с помощью мобильного приложения WhatsApp:
   - Откройте WhatsApp на вашем телефоне
   - Перейдите в Настройки > WhatsApp Web/Desktop
   - Отсканируйте QR-код, отображаемый на экране
4. После подключения статус изменится на "Подключено"

Если QR-код не виден или истек:
1. Нажмите кнопку "Переподключить"
2. Дождитесь появления нового QR-кода
3. Отсканируйте новый код с помощью мобильного WhatsApp

## Обмен сообщениями

### Интерфейс мини-чата

Интерфейс чата позволяет отправлять и получать сообщения в режиме реального времени:

1. Перейдите на страницу чата, нажав "Чат" в инстансе
2. Выберите контакт из левой панели, чтобы начать разговор
3. Окно чата отображает историю сообщений с выбранным контактом
4. Новые сообщения появляются автоматически благодаря периодическому опросу

### Отправка сообщений

Чтобы отправить текстовое сообщение:

1. Выберите контакт из панели контактов
2. Введите ваше сообщение в поле ввода внизу
3. Нажмите Enter или кнопку "Отправить"

### Отправка медиафайлов

Чтобы отправить медиафайлы:

1. Выберите контакт из панели контактов
2. Нажмите кнопку "Прикрепить файл"
3. Выберите файл с вашего устройства
4. Добавьте опциональный текст
5. Нажмите "Отправить медиафайл"

Поддерживаемые типы медиафайлов:
- Изображения
- Видео
- Документы
- Аудиофайлы

## Управление контактами

### Просмотр контактов

Страница контактов отображает все контакты, связанные с инстансом:

1. Перейдите на страницу контактов, нажав "Контакты" в инстансе
2. Просмотрите таблицу всех контактов с их деталями
3. Используйте поле поиска для поиска конкретных контактов

Вы можете переключаться между двумя источниками контактов:
- **WhatsApp**: Контакты с серверов WhatsApp
- **База данных**: Контакты, хранящиеся в локальной базе данных

### Добавление контактов

Чтобы добавить новый контакт:

1. Перейдите на страницу контактов
2. Прокрутите до раздела "Добавить новый контакт"
3. Введите номер телефона (обязательно)
4. Введите имя (опционально)
5. Нажмите "Добавить контакт"

### Импорт контактов

Чтобы импортировать контакты из WhatsApp в локальную базу данных:

1. Перейдите на страницу контактов
2. Нажмите кнопку "Импортировать контакты"
3. Дождитесь завершения процесса импорта
4. Появится сообщение об успешном завершении с количеством импортированных контактов

## Статистика

Страница статистики предоставляет метрики использования ваших инстансов WhatsApp:

1. Перейдите на страницу статистики, нажав "Статистика" в панели навигации
2. Выберите период времени (неделя, месяц, год или все время)
3. Просмотрите агрегированную статистику:
   - Всего отправлено/получено сообщений
   - Отправлено/получено медиафайлов
   - API вызовы
   - Вебхук вызовы
4. Просмотрите статистику отдельных инстансов в таблице ниже

## Профиль пользователя

Страница профиля отображает информацию о вашей учетной записи:

1. Перейдите на страницу профиля
2. Просмотрите ваш email адрес
3. Просмотрите и скопируйте ваш API ключ для программного доступа
4. Просмотрите ваше имя и другие данные учетной записи

## Техническая информация

### API эндпоинты

Пользовательский интерфейс взаимодействует со следующими ключевыми API эндпоинтами:

- `/api/auth/login`: Аутентификация
- `/api/auth/me`: Информация о текущем пользователе
- `/api/instances`: Управление инстансами
- `/api/instances/:id`: Операции с отдельными инстансами
- `/api/instances/:id/qr`: Генерация QR-кода
- `/api/instances/:id/send`: Отправка сообщений
- `/api/instances/:id/contacts`: Управление контактами
- `/api/stats/user`: Статистика использования

### Вебхуки

Вебхуки позволяют внешним системам получать уведомления о событиях:

**Настраиваемые события:**
- Получение сообщения
- Отправка сообщения
- Изменения статуса доставки
- Изменения статуса прочтения

**Формат данных вебхука:**
```json
{
  "event": "message_received",
  "data": {
    "instanceId": "id-инстанса",
    "messageId": "id-сообщения",
    "from": "id-отправителя",
    "body": "содержание-сообщения",
    "timestamp": "iso-дата-время"
  },
  "timestamp": "iso-дата-время"
}
```

**Функции безопасности:**
- Секретный ключ для верификации подписи данных
- Настраиваемый механизм повторных попыток для неудачных доставок
- Поддержка настраиваемых HTTP заголовков
